<html>
	<head>
		<title>Чтение данных</title>
		<script type="text/javascript" src="paper/dist/paper-full.min.js"></script>
	</head>
	<body>
		<button style="width: 50vw; height: 50vh">Click me to request serial port</button>

		<canvas id="myCanvas" resize></canvas>
		<script>
			function paint(values) {
				var canvas = document.getElementById('myCanvas')
				// Create an empty project and a view for the canvas:
				paper.setup(canvas)
				// Create a Paper.js Path to draw a line into it:
				var path = new paper.Path()
				// Give the stroke a color
				path.strokeColor = 'black'
				var start = new paper.Point(100, 100)
				// Move to start and draw a line from there
				path.moveTo(start)
				// Note that the plus operator on Point objects does not work
				// in JavaScript. Instead, we need to call the add() function:
				path.lineTo(start.add([200, -50]))
				// Draw the view now:
				paper.view.draw()
			}
			paint()

			async function readd() {
				let port = await navigator.serial.requestPort()
				await port.open({ baudRate: 9600 /* pick your baud rate */ })
				console.log(port)
				const textDecoder = new TextDecoderStream()
				const readableStreamClosed = port.readable.pipeTo(textDecoder.writable)
				/* const reader = textDecoder.readable
  .pipeThrough(new TransformStream(new LineBreakTransformer()))
  .getReader();*/
				const reader = textDecoder.readable.getReader()
				let gotCode = ''
				while (port.readable) {
					// const reader = port.readable.getReader();
					try {
						while (true) {
							const { value, done } = await reader.read()
							if (gotCode.includes('],]')) {
								// |reader| has been canceled.
								console.log(done)
								console.log(JSON.stringify(gotCode))
								gotCode = eval(gotCode.split('...')[1])
								break
							}
							// Do something with |value|…
							gotCode += value
							// console.log(value, done)
						}
					} catch (error) {
						// Handle |error|…
					} finally {
						// reader.releaseLock()
						paint(gotCode)
					}
				}
			}
			const button = document.querySelector('button')
			button.addEventListener('click', readd)
		</script>
	</body>
</html>

<!-- 
	random далеко-близко-далеко
	[[1,387],[2,388],[3,387],[4,388],[5,387],[6,387],[7,387],[8,388],[9,387],[10,387],[11,387],[12,388],[13,388],[14,388],[15,387],[16,388],[17,387],[18,387],[19,387],[20,387],[21,388],[22,387],[23,388],[24,387],[25,387],[26,387],[27,387],[28,387],[29,387],[30,387],[31,387],[32,387],[33,387],[34,387],[35,387],[36,388],[37,387],[38,387],[39,387],[40,388],[41,388],[42,387],[43,387],[44,388],[45,387],[46,387],[47,387],[48,387],[49,387],[50,387],[51,387],[52,387],[53,387],[54,387],[55,388],[56,387],[57,387],[58,387],[59,387],[60,387],[61,387],[62,387],[63,387],[64,387],[65,387],[66,387],[67,133],[68,2],[69,3],[70,3],[71,3],[72,3],[73,3],[74,3],[75,3],[76,3],[77,3],[78,3],[79,3],[80,3],[81,3],[82,3],[83,3],[84,3],[85,3],[86,3],[87,4],[88,3],[89,4],[90,4],[91,4],[92,4],[93,4],[94,4],[95,4],[96,4],[97,5],[98,5],[99,5],[100,5],[101,5],[102,5],[103,7],[104,8],[105,9],[106,9],[107,10],[108,10],[109,11],[110,12],[111,12],[112,13],[113,13],[114,13],[115,13],[116,13],[117,14],[118,14],[119,14],[120,14],[121,14],[122,14],[123,14],[124,14],[125,15],[126,15],[127,15],[128,16],[129,16],[130,16],[131,15],[132,16],[133,15],[134,15],[135,15],[136,15],[137,15],[138,16],[139,15],[140,15],[141,15],[142,15],[143,16],[144,15],[145,15],[146,15],[147,15],[148,15],[149,15],[150,15],[151,15],[152,15],[153,15],[154,15],[155,15],[156,15],[157,15],[158,15],[159,15],[160,15],[161,15],[162,15],[163,15],[164,15],[165,15],[166,15],[167,15],[168,15],[169,15],[170,15],[171,15],[172,15],[173,15],[174,14],[175,14],[176,14],[177,14],[178,14],[179,14],[180,14],[181,14],[182,14],[183,14],[184,14],[185,13],[186,13],[187,13],[188,13],[189,13],[190,13],[191,13],[192,13],[193,13],[194,14],[195,17],[196,60],[197,381],[198,385],[199,386],[200,386],[201,387],[202,387],[203,388],[204,387],[205,387],[206,387],[207,387],[208,388],[209,387],[210,388],[211,387],[212,387],[213,387],[214,387],[215,387],[216,387],[217,387],[218,388],[219,387],[220,387],[221,387],[222,387],[223,387],[224,387],[225,387],[226,387],[227,387],[228,387],[229,387],[230,388],[231,388],[232,387],[233,387],[234,388],[235,387],[236,387],[237,387],[238,387],[239,387],[240,387],[241,387],[242,387],[243,387],[244,388],[245,387],[246,387],[247,387],[248,388],[249,387],[250,387],[251,387],[252,387],[253,387],[254,387],[255,387],[256,387],[257,387],[258,387],[259,387],[260,387],[261,387],[262,387],[263,387],[264,387],[265,387],[266,387],[267,387],[268,387],[269,387],[270,387],[271,387],[272,387],[273,387],[274,387],[275,387],[276,222],[277,11],[278,12],[279,12],[280,12],[281,12],[282,12],[283,11],[284,11],[285,11],[286,11],[287,11],[288,11],[289,11],[290,11],[291,11],[292,11],[293,11],[294,11],[295,11],[296,11],[297,11],[298,11],[299,11],[300,11],[301,11],[302,11],[303,11],[304,11],[305,11],[306,11],[307,11],[308,11],[309,11],[310,11],[311,11],[312,11],[313,11],[314,11],[315,11],[316,11],[317,11],[318,11],[319,11],[320,11],[321,11],[322,11],[323,11],[324,11],[325,11],[326,11],[327,11],[328,11],[329,11],[330,11],[331,11],[332,11],[333,11],[334,11],[335,11],[336,11],[337,11],[338,11],[339,11],[340,11],[341,11],[342,11],[343,11],[344,10],[345,10],[346,10],[347,10],[348,10],[349,10],[350,10],[351,9],[352,9],[353,9],[354,9],[355,8],[356,8],[357,8],[358,7],[359,7],[0,7],]
	
	дальше и дальше 
	[[1,3],[2,3],[3,3],[4,3],[5,3],[6,3],[7,3],[8,3],[9,3],[10,3],[11,3],[12,3],[13,3],[14,3],[15,3],[16,3],[17,3],[18,3],[19,3],[20,3],[21,3],[22,3],[23,3],[24,3],[25,3],[26,3],[27,3],[28,3],[29,3],[30,3],[31,3],[32,3],[33,3],[34,3],[35,3],[36,3],[37,3],[38,3],[39,3],[40,3],[41,3],[42,3],[43,3],[44,3],[45,3],[46,3],[47,3],[48,3],[49,3],[50,3],[51,3],[52,3],[53,3],[54,3],[55,3],[56,3],[57,4],[58,3],[59,3],[60,3],[61,3],[62,3],[63,3],[64,3],[65,3],[66,3],[67,3],[68,3],[69,3],[70,3],[71,3],[72,3],[73,3],[74,3],[75,3],[76,3],[77,3],[78,3],[79,3],[80,3],[81,3],[82,3],[83,3],[84,3],[85,3],[86,3],[87,3],[88,3],[89,3],[90,3],[91,3],[92,3],[93,3],[94,3],[95,3],[96,3],[97,3],[98,3],[99,3],[100,3],[101,3],[102,3],[103,3],[104,3],[105,3],[106,3],[107,3],[108,3],[109,3],[110,3],[111,3],[112,3],[113,3],[114,3],[115,3],[116,3],[117,4],[118,4],[119,4],[120,4],[121,5],[122,5],[123,5],[124,6],[125,6],[126,7],[127,8],[128,9],[129,10],[130,10],[131,11],[132,11],[133,12],[134,13],[135,13],[136,14],[137,15],[138,15],[139,16],[140,16],[141,16],[142,18],[143,18],[144,20],[145,20],[146,21],[147,21],[148,22],[149,23],[150,23],[151,24],[152,25],[153,25],[154,26],[155,26],[156,27],[157,27],[158,28],[159,28],[160,29],[161,29],[162,29],[163,29],[164,30],[165,31],[166,31],[167,31],[168,31],[169,31],[170,31],[171,31],[172,31],[173,31],[174,31],[175,31],[176,31],[177,31],[178,31],[179,31],[180,31],[181,31],[182,31],[183,31],[184,31],[185,31],[186,31],[187,31],[188,31],[189,31],[190,31],[191,30],[192,30],[193,30],[194,30],[195,30],[196,30],[197,30],[198,30],[199,29],[200,29],[201,29],[202,28],[203,28],[204,28],[205,28],[206,28],[207,28],[208,28],[209,27],[210,27],[211,27],[212,27],[213,27],[214,27],[215,27],[216,27],[217,27],[218,27],[219,27],[220,27],[221,26],[222,26],[223,26],[224,27],[225,27],[226,27],[227,27],[228,27],[229,27],[230,27],[231,27],[232,27],[233,27],[234,27],[235,27],[236,27],[237,27],[238,27],[239,27],[240,27],[241,27],[242,27],[243,27],[244,27],[245,27],[246,27],[247,22],[248,381],[249,384],[250,385],[251,386],[252,386],[253,386],[254,386],[255,386],[256,386],[257,386],[258,386],[259,386],[260,386],[261,386],[262,386],[263,386],[264,386],[265,386],[266,386],[267,386],[268,386],[269,386],[270,386],[271,386],[272,386],[273,386],[274,386],[275,386],[276,386],[277,386],[278,386],[279,386],[280,386],[281,386],[282,386],[283,386],[284,386],[285,386],[286,385],[287,386],[288,386],[289,385],[290,387],[291,386],[292,385],[293,385],[294,386],[295,386],[296,386],[297,385],[298,385],[299,386],[300,386],[301,386],[302,386],[303,386],[304,385],[305,386],[306,386],[307,385],[308,386],[309,386],[310,386],[311,386],[312,386],[313,386],[314,386],[315,386],[316,386],[317,386],[318,386],[319,385],[320,385],[321,386],[322,386],[323,386],[324,386],[325,386],[326,386],[327,386],[328,386],[329,386],[330,386],[331,386],[332,386],[333,386],[334,386],[335,386],[336,386],[337,386],[338,386],[339,386],[340,385],[341,386],[342,386],[343,386],[344,386],[345,386],[346,386],[347,386],[348,386],[349,386],[350,386],[351,386],[352,386],[353,386],[354,386],[355,386],[356,386],[357,386],[358,385],[359,386],[0,385],]

	далеко, далеко, ближе
	[[1,386],[2,386],[3,385],[4,386],[5,385],[6,386],[7,386],[8,386],[9,386],[10,386],[11,385],[12,385],[13,386],[14,386],[15,386],[16,386],[17,386],[18,385],[19,386],[20,386],[21,386],[22,386],[23,386],[24,386],[25,386],[26,386],[27,386],[28,386],[29,386],[30,386],[31,386],[32,386],[33,386],[34,386],[35,386],[36,386],[37,386],[38,386],[39,386],[40,386],[41,386],[42,386],[43,385],[44,386],[45,386],[46,386],[47,386],[48,386],[49,386],[50,386],[51,386],[52,386],[53,386],[54,386],[55,386],[56,386],[57,386],[58,386],[59,386],[60,386],[61,386],[62,386],[63,386],[64,386],[65,386],[66,386],[67,386],[68,386],[69,386],[70,386],[71,386],[72,386],[73,386],[74,386],[75,386],[76,386],[77,386],[78,386],[79,386],[80,386],[81,386],[82,385],[83,386],[84,386],[85,386],[86,386],[87,386],[88,386],[89,386],[90,386],[91,386],[92,386],[93,386],[94,386],[95,386],[96,386],[97,386],[98,385],[99,386],[100,386],[101,386],[102,386],[103,386],[104,385],[105,386],[106,386],[107,386],[108,386],[109,385],[110,386],[111,386],[112,386],[113,386],[114,386],[115,386],[116,386],[117,386],[118,386],[119,386],[120,386],[121,386],[122,386],[123,385],[124,386],[125,386],[126,386],[127,385],[128,386],[129,386],[130,386],[131,386],[132,385],[133,386],[134,385],[135,386],[136,386],[137,386],[138,386],[139,386],[140,386],[141,386],[142,386],[143,386],[144,386],[145,386],[146,386],[147,386],[148,386],[149,386],[150,386],[151,386],[152,386],[153,386],[154,386],[155,386],[156,386],[157,386],[158,386],[159,386],[160,386],[161,386],[162,386],[163,386],[164,385],[165,71],[166,41],[167,41],[168,40],[169,40],[170,40],[171,40],[172,40],[173,40],[174,39],[175,39],[176,39],[177,38],[178,38],[179,38],[180,38],[181,37],[182,37],[183,37],[184,36],[185,37],[186,37],[187,37],[188,36],[189,35],[190,35],[191,35],[192,35],[193,35],[194,34],[195,32],[196,32],[197,31],[198,31],[199,30],[200,30],[201,29],[202,29],[203,29],[204,29],[205,28],[206,28],[207,29],[208,29],[209,28],[210,29],[211,29],[212,29],[213,28],[214,28],[215,28],[216,28],[217,28],[218,28],[219,28],[220,28],[221,27],[222,27],[223,27],[224,27],[225,26],[226,26],[227,26],[228,26],[229,26],[230,25],[231,24],[232,24],[233,24],[234,24],[235,24],[236,24],[237,24],[238,23],[239,23],[240,23],[241,23],[242,23],[243,22],[244,22],[245,22],[246,22],[247,21],[248,21],[249,20],[250,21],[251,20],[252,20],[253,19],[254,18],[255,18],[256,18],[257,18],[258,18],[259,18],[260,18],[261,18],[262,17],[263,17],[264,17],[265,17],[266,16],[267,16],[268,16],[269,16],[270,16],[271,15],[272,15],[273,15],[274,15],[275,14],[276,15],[277,15],[278,14],[279,14],[280,14],[281,14],[282,14],[283,13],[284,13],[285,13],[286,13],[287,13],[288,13],[289,13],[290,13],[291,12],[292,12],[293,13],[294,12],[295,12],[296,12],[297,13],[298,12],[299,12],[300,12],[301,12],[302,12],[303,11],[304,12],[305,12],[306,11],[307,11],[308,11],[309,11],[310,11],[311,11],[312,11],[313,11],[314,11],[315,11],[316,11],[317,10],[318,11],[319,10],[320,10],[321,10],[322,11],[323,18],[324,24],[325,25],[326,25],[327,27],[328,27],[329,28],[330,30],[331,31],[332,34],[333,37],[334,39],[335,39],[336,40],[337,40],[338,39],[339,37],[340,37],[341,37],[342,35],[343,34],[344,34],[345,33],[346,32],[347,31],[348,30],[349,28],[350,26],[351,25],[352,24],[353,23],[354,22],[355,21],[356,21],[357,21],[358,20],[359,19],[0,21],]
-->
